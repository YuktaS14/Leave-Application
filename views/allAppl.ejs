<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Page</title>

  <link rel="shortcut icon" href="#">

  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://smtpjs.com/v3/smtp.js"></script>

  <!-- Latest compiled JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" href="/styles.css" />
  <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>


  <!-- new new -->

  <!-- CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />

  <!-- JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>



  <style>
    .content {
      display: none;
      margin-top: 40px;
    }
  </style>
</head>

<body class="sb-nav-fixed">
  <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
    <!-- Navbar Brand-->
    <a class="navbar-brand ps-3" href="/student">Student Login Page</a>
    <!-- Sidebar Toggle-->
    <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle" href="#!"><i
        class="fas fa-bars"></i></button>
  </nav>
  <div id="layoutSidenav">
    <div id="layoutSidenav_nav">
      <nav class="sb-sidenav acco rdion sb-sidenav-dark" id="sidenavAccordion">
        <div class="sb-sidenav-menu">
          <div class="nav">
            <!-- <div class="sb-sidenav-menu-heading">Core</div> -->
            <div class="sb-sidenav-menu-heading">Core</div>
            <a class="nav-link" id = "viewAppl" href="/admin" onclick="showContent('viewAppl');">
                <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                Back to Dashboard
            </a>
            <div class="sb-sidenav-menu-heading">Interface</div>
            <a class="nav-link" href="/admin/getAll" id="applications" >
              <div class="sb-nav-link-icon"><i class="fas fa-columns"></i></div>
              Get All Applications
            </a>


            <div class="sb-sidenav-menu-heading">Logout</div>
            <a class="nav-link" href="/logout">
              <div class="sb-nav-link-icon"><i class="fas fa-power-off"></i></div>
              Logout
            </a>
          </div>
        </div>
        <div class="sb-sidenav-footer">
          <div class="small">Logged in as:</div>
          Admin
        </div>
      </nav>
    </div>
    <div id="layoutSidenav_content">
      <main>
        <div class="container-fluid px-4">
          <h1 class="mt-4">Leave Applications </h1>
          <ol class="breadcrumb mb-4">
            <li class="breadcrumb-item active">Admin</li>
          </ol>

          <div class="card mb-4 content" id="pastAppl-content" style="display:block;">
            <div class="card-header">
              <i class="fas fa-table me-2"></i>
             Applications Till Now
            </div>
            <div class="card-body">
              <table id="datatablesSimple">
                <thead>
                  <tr>
                    <th>Roll No</th>
                    <th>Name</th>
                    <th>Type of leave</th>
                    <th>Final Status</th>
                    <th>From Date</th>
                    <th>To Date</th>
                    <th>Alternate TA</th>
                  </tr>
                </thead>
                <tfoot>
                  <tr>
                    <th>Roll No</th>
                    <th>Name</th>
                    <th>Type of leave</th>
                    <th>Final Status</th>
                    <th>From Date</th>
                    <th>To Date</th>
                    <th>Alternate TA</th>
                  </tr>
                </tfoot>
                <tbody>

                  <% allAppl.forEach( ( record ) => {%>

                  <tr>
                    <td> <%- record.rollno %> </td>
                    <td> <%- record.nameofscholar %> </td>
                    <td> <%- record.typeofleave %> </td>
                    <td> <%- record.admin_approval %> </td>
                    <td> <%- record.fromdate%> </td>
                    <td> <%- record.todate%> </td>
                    <td> <%- record.alternatestudentname %> </td>

                  </tr>

                  <% } ) %>


                </tbody>
              </table>

            </div>
          </div>




      </main>
      <footer class="py-4 bg-light mt-auto">
        <div class="container-fluid px-4">
          <div class="d-flex align-items-center justify-content-between small">
            <div class="text-muted">Copyright &copy; __</div>
        </div>
      </footer>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    crossorigin="anonymous"></script>
  <!-- <script src="js/scripts.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
  <!-- <script src="assets/demo/chart-area-demo.js"></script> -->
  <!-- <script src="assets/demo/chart-bar-demo.js"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js"
    crossorigin="anonymous"></script>
  <!-- <script src="js/datatables-simple-demo.js"></script> -->









  <script>
    var lastClick = 'button1';
    function showContent(buttonId) {
      const selectedContenthiv = document.getElementById(buttonId + '-content');
      var content = selectedContenthiv.style.display;

      var contenthivs = document.getElementsByClassName('content');
      for (var i = 0; i < contenthivs.length; i++) {
        contenthivs[i].style.display = 'none';
      }

      if (lastClick == buttonId && content == 'block') {
        selectedContenthiv.style.display = 'none';
      }
      else
        selectedContenthiv.style.display = 'block';
      lastClick = buttonId;
    }

    function logout() {
      window.location.href = '/logout';
    }


    function added() {
      document.getElementById("onAdd").innerHTML = "Added Successfully!! ";
      setTimeout(() => {
        document.getElementById("onAdd").innerHTML = '';

      }, 2000);
    }

    window.addEventListener('DOMContentLoaded', event => {

      // Toggle the side navigation
      const sidebarToggle = document.body.querySelector('#sidebarToggle');
      if (sidebarToggle) {
        // Uncomment Below to persist sidebar toggle between refreshes
        // if (localStorage.getItem('sb|sidebar-toggle') === 'true') {
        //     document.body.classList.toggle('sb-sidenav-toggled');
        // }
        sidebarToggle.addEventListener('click', event => {
          event.preventDefault();
          document.body.classList.toggle('sb-sidenav-toggled');
          localStorage.setItem('sb|sidebar-toggle', document.body.classList.contains('sb-sidenav-toggled'));
        });
      }

    });

    // Call the dataTables jQuery plugin
    // $(document).ready(function() {
    //   $('#dataTable').DataTable();
    // });

    window.addEventListener('DOMContentLoaded', event => {
      // Simple-DataTables
      // https://github.com/fiduswriter/Simple-DataTables/wiki

      const datatablesSimple = document.getElementById('datatablesSimple');
      if (datatablesSimple) {
        new simpleDatatables.DataTable(datatablesSimple);
      }
    });






    function countWeekendDays(startDate, endDate) {
      let count = 0;
      let currentDate = new Date(startDate);

      while (currentDate <= endDate) {
        const dayOfWeek = currentDate.getDay();
        if (dayOfWeek === 0 || dayOfWeek === 6) {
          count++;
        }
        currentDate.setDate(currentDate.getDate() + 1);
      }

      return count;
    }


    async function calculateDays() {
      // Get the start and end dates
      const startDate = new Date(document.getElementById("from").value);
      startDate.setHours(0, 0, 0, 0);
      const endDate = new Date(document.getElementById("to").value);
      endDate.setHours(0, 0, 0, 0);

      if ((!endDate) || (!startDate)) {
        return;
      }

      if (startDate && endDate) {

        if (endDate < startDate) {
          alert("check start and end dates")
          document.getElementById("from").value = "";
          document.getElementById("to").value = "";
          return;
        }

      }

      var counter = 0
      var lst = []


      lst.forEach((y) => {

        // console.log(startDate)
        // console.log(y)
        // console.log(endDate)

        if ((startDate <= y) && (y <= endDate)) {
          counter = counter + 1;
        }
      })

      // dates.forEach( (r) =>{
      //     console.log(r.date)
      // } )

      console.log(counter)

      // Calculate the number of days between the dates
      const numDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));

      // Set the value of the "Number of Days" input field
      const numdays = numDays - countWeekendDays(startDate, endDate) + 1 - counter;

      const allow = document.getElementById('noOfLeavesLeft').value
      let flag = false
      if (numdays >= allow) {
        alert(`You are applying for more days than allocated days`);
        document.getElementById("overflowDays").value = (numdays - allow)
        document.getElementById("overflowDays").style = 'color:red'
        flag = true
      }
      if (!flag) {
        document.getElementById("overflowDays").value = 0
        document.getElementById("overflowDays").style = 'color:black'
      }
      document.getElementById("noOfDays").value = numdays;
    }

    function handleleavetype() {

      const val = document.getElementById("typeOfLeave").value;
      var inputbox = document.getElementById("typeOfLeaveReason");
      var text = "None"
      if (val == "1") {
        text = `Leave with stipend not exceeding 30 days for each completed year of tenure may be allowed. Sanction of leave without stipend may be considered under special circumstances. If the Fellow is away from the Institute for more than a period of 7 days, then all the holidays that come within that period will be counted as leave.`
      }
      else if (val == "2") {
        text = `The Fellow should take permission for visits abroad for attending conferences/seminars etc. The absence for such foreign visits will be treated as on duty.`
      }
      else if (val == "3") {
        text = `Women Fellows with less than two surviving children are entitled to full stipend plus HRA, during the period of absence up to 180 days on grounds of maternity once in the entire duration of PhD. The Fellowship amount for leave period will be paid after the fellow resumes duty and submits a medical certificate in support of actual confinement. It is expected that the Fellow will make up for the research work during the remaining tenure.`
      }
      else if (val == "4") {
        text = `Second maternity leave applications from the women research scholars shall be considered as under “other valid reasons” for grant of leave. Accordingly, the second maternity leave, if granted, shall be without any fellowship. The total duration of the fellowship should be five years from the date of joining and any extension provided beyond five years shall be without fellowship.`
      }
      else if (val == "5") {
        text = `Male Fellows of institute HTRA / CSIR are entitled for 15 days paternity leave during the confinement of his wife on submission of relevant documentary proof. The leave shall be taken at a single stretch, without a break and can be availed only once during the period of fellowship.`
      }
      else {
        inputbox.style.display = "none"
        return;
      }

      inputbox.style.display = "block"
      inputbox.innerHTML = '<i>' + text + '</i>';
    }



  </script>





</body>

</html>